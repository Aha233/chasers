# C4.11 类型转换
在C++ 语言中，某些类型之间有关联。如果两种类型有关联，那么当程序需要其中一种类型的运算符的运算对象时，可以用另一种关联类型的对象或值来替代。换句话说，如果两种类型可以**相互转换（conversion）** ，那么它们就是关联的。

考虑下面的表达式，它的目的是将`ival`初始化为`6`：
```cpp
int ival = 3.14 + 3;    //编译器可能会警告该运算损失了精度
```

加法的两个运算对象类型不同：`3.14`的类型是`double`，`3`的类型是`int`。C++ 语言不会直接将两个不同类型的值相加，而是先根据类型转换规则设法将运算对象的类型统一之后再求值。上述的类型转换是自动执行的，无须程序员的介入，有时甚至不需要程序员了解。因此，它们被称为**隐式类型转换（implicit conversion）**。

算数类型之间的隐式转换被设计得尽可能避免精度丢失。很多时候，如果表达式中既有整数类型的运算对象也有浮点数类型的运算对象，整型会转换成浮点型。在上面的例子中，`3`被转换成`double`类型，然后执行浮点数加法，所得结果的类型是`double`。

接下来就要完成初始化的任务了。在初始化过程中，因为被初始化的对象的类型无法改变，所以初始值被转换成该对象的类型。仍在这个例子中，加法运算符得到的`double`类型的结果转换成`int`类型的值，这个值被用来初始化`ival`。由`double`向`int`转换时忽略了小数部分，上面的表达式中，数值`6`被赋给了`ival`。

**何时发生隐式类型转换**  

- 在大多数表达式中，比`int`类型小的整型值首先提升为较大的整数类型。
- 在条件中，非布尔值转换成布尔值类型。
- 初始化过程中，初始值转换成变量的类型；在赋值语句中，右侧运算对象转换成左侧运算对象的类型。
- 如果算术运算或关系运算的运算对象有多种类型，需要转换成同一种类型。
- 函数调用也会发生类型转换。

## 算术转换
**算术转换（arithmetic conversion)** 的含义是把一种算术类型转换成另外一种算术类型。算数转换的规则定义了一套类型转换的层次，其中运算符的运算对象将转换成最宽的类型。例如，如果一个运算对象的类型是`long double`，那么无论另外一种算术对象的类型是什么都会转换成`long double`。还有一种更普遍的情况，当表达式中既有浮点型也有整数类型时，整数值将转换成相应的浮点类型。

### 整型提升
**整型提升（integral promotion）** 负责把小整数类型转换成较大的整数类型。对于`bool`、`char`、`signed char`、`unsigned char`、`short`和`unsigned short`等类型来说，只要它们所有可能的值都能存在`int`里，它们就会提升成`int`类型；否则，提升成`unsigned int`类型。

较大的`char`类型（`wchar_t`、`char16_t`、`char32_t`）提升成`int`、`unsigned int`、`long`、`unsigned long`、`long long`和`unsigned long long`中最小的一种类型，前提是转换后的类型要能容纳原类型所有可能的值。

### 无符号类型的运算对象
如果某个运算符的运算对象类型不一致，这些运算对象将转换成同一种类型。但是如果某个运算对象的类型是无符号类型，那么转换的结果就要依赖于机器中各个整数类型的相对大小了。

## 其他隐式类型转换
除了算术转换之外还有几种隐式类型转换：
- **数组转换成指针**：在大多数用到数组的表达式中，数组自动转换成指向数组首元素的指针；当数组被用作`decltype`关键字的参数，或者作为取地址符（`&`）、`sizeof`及`typeid`等运算符的运算对象时，该转换不会发生。
- **指针的转换**：C++还规定了几种其他的指针转换方式，包括常量整数值`0`或者字面值`nullptr`能转换成任意指针类型；指向任意非常量的指针能转换成`void*`；指向任意对象的追风能转换成`const void*`。
- **转换成布尔类型**：存在一种从算术类型或指针类型向布尔类型自动转换的机制。如果算术类型或指针类型的值为`0`，转换结果是`false`；否则转换结果是`true`。
- **转换成常量**：允许将指向非常量类型的指针转换成指向相应常量类型的指针，对于引用也是这样
- **类类型定义的转换**：类类型能定义由编译器自动执行的转换，不过编译器每次只能执行一种类类型的转换

## 显式转换
有时我们希望显式地将对象强制转换成另外一种类型。例如，如果想在下面的代码中执行浮点数除法：
```cpp
int i,j;
double slope = i / j;
```

就要使用某种方法将`i`和`/`或`j`显式地转换成`double`，这种方法称作**强制类型转换（cast）**。

略